\subsection{Parsing af råvarer}

\subsubsection{Råvaretabellen}
\label{subsec:parsingafraavarer}
Efter afprøvning af prototyperne 2A og 2B på informanterne blev vi klar over at råvarer skal indtastes på forsiden i et design meget lig med Googles. Informanterne var glade for autocomplete-funktionen, der gør det muligt at indtaste teksten \textit{ba} i søge feltet og få stillet nogle forslag som \fx \textit{banan, balsamico}, så det ikke er nødvendigt at stave hele råvaren.
En autocomplete-funktion skal have noget data at stille forslag fra, og i dette tilfælde har vi brug for en tabel med alle de forskellige råvarer man kan forestille sig at en bruger vil indtaste. Denne tabel over råvarer vil fremover blive kaldt råvaretabellen.

Da opskrifterne, der søges på, kommer fra Arla, ville det have været nemt hvis Arla havde offentliggjort en liste over de forskellige ingredienser de benytter, således vi kunne bruge denne data som vores råvaretabel. En sådan liste var ikke til at finde, så vi begyndte at overveje muligheden for at lave råvaretabellen ved at parse ingredienserne direkte fra Arlas opskrifter. Et eksempel på ingrediensernes navne i Arlas opskrifter:

375 g rød peberfrugt i strimler

3 røde peberfrugter (ca. 600 g)

4 røde peberfrugter i store tern (ca. 500 g)

En bruger, der indtaster teksten \textit{pe} i forsøget på at indtaste \textit{rød peberfrugt}, skal kun præsenteres for forskellige råvarer, og altså ikke samme råvare i forskellige mængder og former (skiver, strimler, hakket, m.m.). Det vil sige, at de mange forskellige ingredienser, der alle består af en rød peberfrugt, kun skal medføre at \textit{rød peberfrugt} findes én gang i råvaretabellen. Vi vurderede at Arlas navngivning af ingredienser har været for forskellig til blive brugt som kilde til vores råvaretabel. Råvaretabellen er i stedet blevet lavet ud fra en liste af råvarer offentliggjort af madopskrifter.nu. Et udpluk af listen ser således ud:

\begin{itemize}
\item Rød peberfrugt
\item Persille
\item Citron
\end{itemize}

Listen fra madopskrifter.nu blev brugt som vores råvaretabel af følgende grunde:

\begin{itemize}
\item Listen indeholdt kun 4 dubletter, som selvfølgelig blev fjernet
\item Råvarerne indeholdt kun den rå råvare, ingen mængder eller andre betegnelser (vaskede, skrællede, m.m.)
\item Listen omfattede 933 råvarer, hvilket vi anså som rigeligt
\end{itemize}

\subsubsection{Parsing af opskrifter}
Råvaretabellen giver brugeren mulighed for at indtaste en mængde råvarer. Hvis han indtaster råvaren \textit{gulerødder}, skal han muligheden for at udføre en søgning, der finder alle opskrifter, der indeholder gulerødder. Det er derfor nødvendigt, ud fra alle ingredienser i en opskrift, at kunne afgøre hvilken af råvarerne i råvaretabellen, der er magen til. Som før nævnt er ingrediensernes navne i Arlas opskrifter meget inkonsistente. Derfor vil navnene kun i få tilfælde være helt ens. Det er derfor nødvendigt med en metode til at kunne sammenligne to tekster og bestemme hvor meget de minder om hinanden. Med en sådan metode vil det nemlig være muligt, for hver ingrediens at finde den råvare der minder mest om.

Hvis tekstsammenligningsfunktionen køres hver gang der udføres en søgning, vil det stille høje krav til hastigheden af denne funktion, for at brugeren kan udføre en hurtig søgning. For ikke at sætte krav til hastigheden af funktionen, benytter vi en relationstabel. For hver opskrift fundet på Arla sammenligning vi hver enkelt ingrediens i opskriften med alle råvarerne i råvaretabellen med vores tekstsammenligningsfunktion. For hver ingrediens indsættes én relation mellem ingrediensen og den råvare i råvaretabellen, som ingrediensen bedst matcher ifølge vores tekstsammenlignignsfunktion. Når en bruger udfører en søgning, vil tekstsammenligningsfunktionen slet ikke blive benyttet. Det vil kun være nødvendigt at undersøge de indtastede råvares relationer til ingredienser, og blot præsentere de opskrifter, der er relateret til de fundne ingredienser, som et søgeresultat for brugeren.


\subsubsection{Tekstsammenligningsfunktion}
Der findes mange forskellige algoritmer til at sammenligne to tekststrenge for lighed. Det er vigtigt for os at finde en god og brugbar metode, der så korrekt som muligt kan mappe alle ingredienserne i Arlas opskrifter over til en passende råvare i vores råvaretabel. Det er ikke realistisk at opnå en 100 \% korrekt mapping. Vi har erfaret, at der nemt kan opstå problemer omkring ingredienser der minder meget om hinanden, som \fx ved mapping af ingrediensen \textit{hakket løg}. En parser vil have svært ved at vide, at \textit{hakket løg} skal mappes til råvaren \textit{løg} og ikke \textit{hakket oksekød}. En korrekt mapping vil i dette tilfælde kræve kendskab til at ordet \textit{hakket} er et udsagnsord og derfor bør fjernes før der forsøges at mappe. Men hvis vi vil mappe ingrediensen \textit{hakket oksekød}, så er det nødvendigt at ordet \textit{hakket} stadig indgår under mappingen (på trods af at det er et udsagnsord), fordi der findes mange former for oksekød og vi ønsker at skelne imellem de forskellige former.

Vi har brugt tilfældigt udvalgte ingredienser fra Arlas opskrifter til at teste 5 forskellige metoder til tekstsammenligning. I mange tilfælde kunne alle 5 metoder mappe en ingrediens til en korrekt råvare. I enkelte tilfælde skete der dog en fejlmapping, hvilket kan ses i \tableref{table:mapping}.

\paragraph{Forklaring af de forskellige tekstsammenligningsfunktioner}
\begin{enumerate}
\item Egen algoritme (lineær)
\item Egen algoritme (eksponentiel)
\item Levenshtein (1 point for slet, tilføj og udskift) %kilde ruby gem levenshtein.distance
\item Levenshtein (1 point for slet, tilføj og udskift. Score divideres med længste streng) %kilde ruby gem levenshtein.normalized_distance
\item Levenshtein (1 point for slet og tilføj. 2 point for udskift) %kilde ruby gem text.levenshtein.distance med modificeret vægt
\end{enumerate}


\begin{table}
    \begin{tabular}{|p{2cm}|c|c|c|c|c|}
        \hline
        Ingrediens                                                 & Metode 1        & Metode 2                & Metode 3           & Metode 4           & Metode 5        \\ \hline
        dildkvist                                                  & dild            & dild                    & dild               & sildefilet         & dild            \\ \hline
        groft salt                                                 & salt            & citron saft             & frugtsaft          & frugtsaft          & salt            \\ \hline
        grofthakkede krydderurter, fx koriander, persille og dild & krydderurtemix  & tikka (indisk krydderi) & hakkede tomater    & hakkede tomater    & hakkede tomater \\ \hline
        basmatiris eller luftige urteris                           & basmati ris     & herbamare urtebouillon  & basmati ris        & basmati ris        & basmati ris     \\ \hline
        ostindisk karry                                            & karrypasta      & kinaradise              & sød sherry         & sød sherry         & karry           \\ \hline
        frisk salvie                                               & salvie          & salvie                  & fiskesauce         & fiskesauce         & salvie          \\ \hline
        koncentreret tomatpure                                     & tomatpure       & tomatpure               & soltørrede tomater & soltørrede tomater & tomatpure       \\ \hline
        hakket svinelever                                          & hakket svinekød & svinelever              & hakket svinekød    & hakket svinekød    & svinelever      \\ \hline
        store kapers med stilk                                     & kapers          & syltede artiskokhjerter & trefarvet is       & trefarvet is       & kapers          \\ \hline
        hvidvin fx rieslin                                         & hvidvin         & hvidvin                 & hvidvinseddike     & hvidvinseddike     & hvidvin         \\ \hline
        friskpresset limesaft                                      & limesaft        & limesaft                & appelsinsaft       & appelsinsaft       & limesaft        \\ \hline
        kartoffel                                                  & kartofler       & kartofler               & kartofler          & kartofler          & kartoffelmel    \\ \hline
        ~                                                          & ~               & ~                       & ~                  & ~                  & ~               \\ \hline
        Total:                                                     & 11              & 7                       & 3                  & 2                  & 10              \\
        \hline
    \end{tabular}
  \caption{Test af flere forskellige tekstsammenligningsfunktioner brugt til at mappe en ingrediens til en råvare. Fed skrift betyder at begge vores informanter har godkendt mappingen.}  \label{table:test-af-compares}
\end{table}

Som det ses i \tableref{table:test-af-compares}, var metode 1 den, der gav den bedste mapping. Metoden fik 11 rigtige ud af 12 mulige, men det bør bemærkes at sammenligningen kun er foretaget på de ingredienser, som mindst én metode mappede forkert. Vi kom forbi 56 ingredienser udover de ingredienser vist her, før vi havde 12 ingredienser til sammenligningen, som én eller flere metoder mappede forkert. 

Metode 1 er en algoritme vi selv har udviklet, der er beskrevet med pseudokode i \algref{alg:parsing}. Den tager to tekststrenge som input, og returnerer en værdi mellem 0 og 100. Højere returværdi betyder større lighed mellem de to inputtede strenge. 100 point opnås kun ved identiske strenge.
Her ses et eksempel på hvordan algoritmen sammenligner \textit{hummersuppe} med \textit{suppe med hummerhale}:


\begin{algorithm} [H]
	\capt{Algoritmen udregner hvor ens to tekststrenge er.}
	\label{alg:parsing}
	\input{pseudokode/parsing}
\end{algorithm}

Et eksempel på hvordan algoritmen virker:
\begin{table}
    \begin{tabular}{|l|l|l|}
        \hline
        str1        & str2                  & ~                             \\ \hline
        \textbf{hummer}suppe & suppe med \textbf{hummer}haler & max_length = 21               \\ 
        \textbf{suppe}       & \textbf{suppe} med haler       & score = 36                    \\ 
        ~           &  med haler            & score = 36 + 25 = 61          \\ 
        ~           & ~                     & max_score = 21 * 21  = 441    \\ 
        ~           & ~                     & score = 61 / 441 * 100 = 13.8 \\
        \hline
    \end{tabular}
\end{table}